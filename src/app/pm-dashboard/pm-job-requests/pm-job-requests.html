<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Project Manager Job Requests</title>

    <!-- FontAwesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <div class="pm-job-requests-container">
      <!-- Header Section -->
      <section class="header-section">
        <h1>Project Manager Job Requests</h1>
        <p>Manage all your allocated job requests efficiently</p>
      </section>

      <!-- Stats Section -->
      <section class="stats-grid">
        <div class="stat-item">
          <div class="stat-number">{{ countOfAllJobRequests }}</div>
          <div class="stat-label">Total Job Requests</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ countOfPendingJobRequests }}</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ countOfApprovedJobRequests }}</div>
          <div class="stat-label">Forwarded To HR</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ CountOfClosedJobRequests }}</div>
          <div class="stat-label">Assigned To Bench</div>
        </div>

        <div class="stat-item">
          <div class="stat-number">0</div>
          <div class="stat-label">Declined</div>
        </div>
      </section>

      <!-- Filter Buttons -->
      <section class="filter-buttons">
        <button
          class="filter-btn"
          [class.active]="selectedFilter === 'all'"
          (click)="applyFilter('all')"
        >
          All
        </button>

        <button
          class="filter-btn"
          [class.active]="selectedFilter === 'pending'"
          (click)="applyFilter('pending')"
        >
          Pending
        </button>

        <button
          class="filter-btn"
          [class.active]="selectedFilter === 'forwarded'"
          (click)="applyFilter('forwarded')"
        >
          Forwarded To HR
        </button>

        <button
          class="filter-btn"
          [class.active]="selectedFilter === 'assigned'"
          (click)="applyFilter('assigned')"
        >
          Assigned To Bench
        </button>


         <button
          class="filter-btn"
          [class.active]="selectedFilter === 'declined'"
          (click)="applyFilter('declined')"
        >
        Declined
        </button>

      </section>

      <!-- Job Requests Cards -->
      <section class="cards-grid" id="jobRequestsGrid">
        @for (item of filteredJobRequests; track item.jobRequestId ) {
        <div class="card" data-status="incoming">
          <div class="card-header">
            <div>
              <div class="card-title">{{ item.title }}</div>
              <div class="card-subtitle">{{ item.jobRequestId }}</div>
            </div>
            <span class="status-badge" [ngClass]="getStatusClass(item.status)">
              {{ getStatusLabel(item.status) }}</span
            >
          </div>
          <div class="card-content">
            <div class="info-row">
              <span class="info-label">Description:</span>
              <span class="info-value">{{ item.description }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Skills:</span>
              <span class="info-value">{{ item.skills }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Experience:</span>
              <span class="info-value"
                >{{ item.minExperience }} - {{ item.maxExperience }} years</span
              >
            </div>
            <div class="info-row">
              <span class="info-label">CTC:</span>
              <span class="info-value">{{ item.minCtc }} - {{ item.maxCtc }} Lp</span>
            </div>
            <div class="info-row">
              <span class="info-label">Priority:</span>
              <span class="info-value" [ngClass]="getPriorityClass(item.priority)">
                {{ item.priority }}
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Job Type:</span>
              <span class="info-value">{{ item.jobType }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Headcount:</span>
              <span class="info-value">{{ item.headCount }}</span>
            </div>
          </div>
          <div class="card-actions" *ngIf="item.status === 'SUBMITTED'">
            <button
              class="btn btn-check-bench"
              [routerLink]="['/pm-dashboard/bench-employees']"
              [queryParams]="{ jobRequestId: item.jobRequestId, projectId: item.projectId }"
              aria-label="Check Bench First"
            >
              <i class="fas fa-check-circle"></i> Check Bench First
            </button>

            <button class="btn btn-forward-hr" (click)="openForwardToHRForm(item.jobRequestId)">
              <i class="fas fa-paper-plane"></i> Forward To HR
            </button>

            <button class="btn btn-terminate" (click)="declineJobRequest(item.jobRequestId)">
              <i class="fas fa-times-circle"></i> Decline
            </button>
          </div>
        </div>
        }
      </section>
    </div>

    <!-- Forward To HR Form Modal (MOVED OUTSIDE THE LOOP) -->
    <div *ngIf="showHrForm" class="modal-overlay" (click)="closeForwardToHRForm()">
      <div class="modal-dialog" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2><i class="fas fa-paper-plane"></i> Forward to HR</h2>
          <button class="close-btn" (click)="closeForwardToHRForm()" aria-label="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form (ngSubmit)="onSubmitForwardToHR()">
          <div class="modal-body">
            <div class="form-group">
              <label for="hrId">
                <i class="fas fa-user"></i> HR ID <span class="required">*</span>
              </label>
              <select
                id="hrId"
                [(ngModel)]="hrForwardDTO.hrId"
                name="hrId"
                class="form-control"
                required
              >
                <option value="" disabled selected>Select HR</option>
                <option *ngFor="let hr of hrIds" [value]="hr">{{ hr }}</option>
              </select>
            </div>

            

            <div class="form-group">
              <label for="priority">
                <i class="fas fa-flag"></i> Priority <span class="required">*</span>
              </label>
              <select
                id="priority"
                [(ngModel)]="hrForwardDTO.priority"
                name="priority"
                class="form-control"
                required
              >
                <option value="LOW">Low</option>
                <option value="MEDIUM">Medium</option>
                <option value="HIGH">High</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="minCtc">
                  <i class="fas fa-rupee-sign"></i> Min CTC <span class="required">*</span>
                </label>
                <input
                  type="number"
                  id="minCtc"
                  [(ngModel)]="hrForwardDTO.minCtc"
                  name="minCtc"
                  class="form-control"
                  placeholder="Minimum CTC"
                  required
                />
              </div>

              <div class="form-group">
                <label for="maxCtc">
                  <i class="fas fa-rupee-sign"></i> Max CTC <span class="required">*</span>
                </label>
                <input
                  type="number"
                  id="maxCtc"
                  [(ngModel)]="hrForwardDTO.maxCtc"
                  name="maxCtc"
                  class="form-control"
                  placeholder="Maximum CTC"
                  required
                />
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" (click)="closeForwardToHRForm()" class="btn btn-cancel">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-submit">
              <i class="fas fa-paper-plane"></i> Forward
            </button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
